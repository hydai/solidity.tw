<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>EIP-3540 電腦程式的新衣服 - EVM 物件格式 (EOF) | 一本關於 Ethereum 與 Solidity 智能合約的書</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="在 2022 年，我們該如何學習智能合約開發">
    
    <link rel="preload" href="/assets/css/0.styles.9f477098.css" as="style"><link rel="preload" href="/assets/js/app.03130786.js" as="script"><link rel="preload" href="/assets/js/2.ce7b5ffa.js" as="script"><link rel="preload" href="/assets/js/1.843ff0e7.js" as="script"><link rel="preload" href="/assets/js/55.21b3d617.js" as="script"><link rel="prefetch" href="/assets/js/10.c12fac62.js"><link rel="prefetch" href="/assets/js/11.c2affc04.js"><link rel="prefetch" href="/assets/js/12.f054eba6.js"><link rel="prefetch" href="/assets/js/13.e4d40fa1.js"><link rel="prefetch" href="/assets/js/14.ed0a28d5.js"><link rel="prefetch" href="/assets/js/15.d25bd3fe.js"><link rel="prefetch" href="/assets/js/16.97c2c4a8.js"><link rel="prefetch" href="/assets/js/17.849d402a.js"><link rel="prefetch" href="/assets/js/18.cdc68d17.js"><link rel="prefetch" href="/assets/js/19.e30826d9.js"><link rel="prefetch" href="/assets/js/20.8effbcd5.js"><link rel="prefetch" href="/assets/js/21.9653cdd5.js"><link rel="prefetch" href="/assets/js/22.b7240f47.js"><link rel="prefetch" href="/assets/js/23.24125751.js"><link rel="prefetch" href="/assets/js/24.778ffaf6.js"><link rel="prefetch" href="/assets/js/25.1ecda9e0.js"><link rel="prefetch" href="/assets/js/26.e699b744.js"><link rel="prefetch" href="/assets/js/27.74198ac3.js"><link rel="prefetch" href="/assets/js/28.ec93b5b4.js"><link rel="prefetch" href="/assets/js/29.ceeccee0.js"><link rel="prefetch" href="/assets/js/3.16c4453f.js"><link rel="prefetch" href="/assets/js/30.8adee311.js"><link rel="prefetch" href="/assets/js/31.ceebd025.js"><link rel="prefetch" href="/assets/js/32.14fd2d9a.js"><link rel="prefetch" href="/assets/js/33.33a6c23b.js"><link rel="prefetch" href="/assets/js/34.2ccf4e58.js"><link rel="prefetch" href="/assets/js/35.ef83bbea.js"><link rel="prefetch" href="/assets/js/36.7ad1a99a.js"><link rel="prefetch" href="/assets/js/37.d6736751.js"><link rel="prefetch" href="/assets/js/38.9ca9000c.js"><link rel="prefetch" href="/assets/js/39.38a0b840.js"><link rel="prefetch" href="/assets/js/4.7b5274ce.js"><link rel="prefetch" href="/assets/js/40.fe435d35.js"><link rel="prefetch" href="/assets/js/41.1f2152ba.js"><link rel="prefetch" href="/assets/js/42.44d60617.js"><link rel="prefetch" href="/assets/js/43.f1b1ce3c.js"><link rel="prefetch" href="/assets/js/44.f73ca724.js"><link rel="prefetch" href="/assets/js/45.d9dca9b1.js"><link rel="prefetch" href="/assets/js/46.ec7f0f6c.js"><link rel="prefetch" href="/assets/js/47.d878efb0.js"><link rel="prefetch" href="/assets/js/48.f3ce3acc.js"><link rel="prefetch" href="/assets/js/49.661853c3.js"><link rel="prefetch" href="/assets/js/5.a90aa973.js"><link rel="prefetch" href="/assets/js/50.6e80d28e.js"><link rel="prefetch" href="/assets/js/51.f60bbd2a.js"><link rel="prefetch" href="/assets/js/52.522cda49.js"><link rel="prefetch" href="/assets/js/53.5adc043f.js"><link rel="prefetch" href="/assets/js/54.b525daad.js"><link rel="prefetch" href="/assets/js/56.c7eb1c6a.js"><link rel="prefetch" href="/assets/js/57.41fdcd65.js"><link rel="prefetch" href="/assets/js/58.c55b3710.js"><link rel="prefetch" href="/assets/js/59.c9dd68a1.js"><link rel="prefetch" href="/assets/js/6.acf7bb6e.js"><link rel="prefetch" href="/assets/js/60.81f5cc2d.js"><link rel="prefetch" href="/assets/js/61.43d2db04.js"><link rel="prefetch" href="/assets/js/62.e95306e3.js"><link rel="prefetch" href="/assets/js/63.961a053b.js"><link rel="prefetch" href="/assets/js/64.38dcb943.js"><link rel="prefetch" href="/assets/js/65.2886d427.js"><link rel="prefetch" href="/assets/js/66.e48e3971.js"><link rel="prefetch" href="/assets/js/67.c4c643de.js"><link rel="prefetch" href="/assets/js/7.dfcce160.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.d9dffa33.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9f477098.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">一本關於 Ethereum 與 Solidity 智能合約的書</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首頁
</a></div><div class="nav-item"><a href="/ethereum-101/" class="nav-link">
  那些關於 Ethereum 的事
</a></div><div class="nav-item"><a href="https://youtube.com/playlist?list=PLHmOMPRfmOxQYDnXAc1hKY6ra4WDU8ZlM" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在 2022 年，我們該如何寫智能合約
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.youtube.com/playlist?list=PLHmOMPRfmOxTiqyaSu1EXs8ioESZtOSHN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  淺入淺出 EVM Object Format
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hydai/solidity.tw" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首頁
</a></div><div class="nav-item"><a href="/ethereum-101/" class="nav-link">
  那些關於 Ethereum 的事
</a></div><div class="nav-item"><a href="https://youtube.com/playlist?list=PLHmOMPRfmOxQYDnXAc1hKY6ra4WDU8ZlM" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在 2022 年，我們該如何寫智能合約
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.youtube.com/playlist?list=PLHmOMPRfmOxTiqyaSu1EXs8ioESZtOSHN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  淺入淺出 EVM Object Format
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hydai/solidity.tw" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Head First Eof</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/head-first-eof/" aria-current="page" class="sidebar-link">深入淺出 EOFv1</a></li><li><a href="/head-first-eof/EIP-3540.html" aria-current="page" class="active sidebar-link">EIP-3540 電腦程式的新衣服 - EVM 物件格式 (EOF)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/head-first-eof/EIP-3540.html#注意事項" class="sidebar-link">注意事項</a></li><li class="sidebar-sub-header"><a href="/head-first-eof/EIP-3540.html#簡單說明" class="sidebar-link">簡單說明</a></li><li class="sidebar-sub-header"><a href="/head-first-eof/EIP-3540.html#為什麼需要這個" class="sidebar-link">為什麼需要這個？</a></li><li class="sidebar-sub-header"><a href="/head-first-eof/EIP-3540.html#詳細規格" class="sidebar-link">詳細規格</a></li><li class="sidebar-sub-header"><a href="/head-first-eof/EIP-3540.html#設計原因" class="sidebar-link">設計原因</a></li></ul></li><li><a href="/head-first-eof/EIP-3541.html" class="sidebar-link">EIP-3541 禁止以 0xEF 開頭的新智慧合約</a></li><li><a href="/head-first-eof/EIP-3670.html" class="sidebar-link">智慧合約的程式碼檢查</a></li><li><a href="/head-first-eof/EIP-4200.html" class="sidebar-link">EIP-4200：EOF - 靜態相對跳躍</a></li><li><a href="/head-first-eof/EIP-4750.html" class="sidebar-link">EIP-4750 EOF 函式功能</a></li><li><a href="/head-first-eof/EIP-5450.html" class="sidebar-link">EOF - 堆疊驗證</a></li><li><a href="/head-first-eof/EIP-6206.html" class="sidebar-link">EIP-6206 - JUMPF 與非回傳函式</a></li><li><a href="/head-first-eof/EIP-663.html" class="sidebar-link">EIP-663：SWAPN、DUPN 和 EXCHANGE 指令</a></li><li><a href="/head-first-eof/EIP-7069.html" class="sidebar-link">EIP-7069 改良版呼叫指令</a></li><li><a href="/head-first-eof/EIP-7480.html" class="sidebar-link">EOF - 資料區段存取指令</a></li><li><a href="/head-first-eof/EIP-7620.html" class="sidebar-link">EIP-7620：EOF 合約部署新方式</a></li><li><a href="/head-first-eof/EIP-7698.html" class="sidebar-link">EIP-7698: EOF - 部署交易</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="eip-3540-電腦程式的新衣服-evm-物件格式-eof"><a href="#eip-3540-電腦程式的新衣服-evm-物件格式-eof" class="header-anchor">#</a> EIP-3540 電腦程式的新衣服 - EVM 物件格式 (EOF)</h1> <h2 id="注意事項"><a href="#注意事項" class="header-anchor">#</a> 注意事項</h2> <p>本文並沒有經過作者外的其他審查者審核，因此若內容有誤，請到 issue 區提出問題，我會儘速修改，謝謝。</p> <h2 id="簡單說明"><a href="#簡單說明" class="header-anchor">#</a> 簡單說明</h2> <p>我們要給電腦程式一種新的「包裝方式」，就像是給程式穿上一件新衣服。這種新包裝讓EVM 可以快速辨識程式的不同部分，比如哪部分是實際要執行的指令，哪部分只是資料。而且這件新衣服還可以隨時升級，加入更多功能！</p> <p>這種新包裝的程式長得像這樣：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>魔法標記, 版本號, (區塊類型, 區塊大小)+, 0, &lt;區塊內容&gt;
</code></pre></div><h2 id="為什麼需要這個"><a href="#為什麼需要這個" class="header-anchor">#</a> 為什麼需要這個？</h2> <p>現在的以太坊區塊鏈上，程式沒有固定的結構。導致 EVM 需要每次在執行期間都需要重新檢查整個程式，這樣會額外消耗執行時間與資源。</p> <p>有了這個新包裝，電腦只需要在程式上傳到區塊鏈前檢查一次。這樣做有幾個好處：</p> <ol><li>可以區分「指令」和「資料」，就像分清楚「食譜步驟」和「食材」一樣</li> <li>引入版本的概念，可以更容易地加入新功能或移除舊功能，不像以前需要透過硬分岔的區塊高度來控制行為</li> <li>讓程式更安全，因為電腦可以事先確認程式是否正確</li></ol> <h2 id="詳細規格"><a href="#詳細規格" class="header-anchor">#</a> 詳細規格</h2> <p>新的格式用特殊的開頭標記（魔法標記）來識別。這個標記是 <code>0xEF00</code>，這有點像是一個特殊印章，說明「這是一個使用 EOF 格式的程式碼」。</p> <h3 id="容器規格"><a href="#容器規格" class="header-anchor">#</a> 容器規格</h3> <p>這個新包裝（我們稱為 EOF 容器）包含：</p> <p>| 說明 | 長度 | 值 | |
|-------------|----------|------------|
| 魔法標記 | 2位元組 | 0xEF00 |
| 版本號 | 1位元組 | 0x01–0xFF |</p> <p>EOF 容器的開頭後面跟著至少一個區塊標頭。每個區塊標頭包含兩個欄位：</p> <ol><li><code>區塊類型</code></li> <li><code>區塊大小</code>或<code>區塊大小列表</code>，取決於該區塊的類型。當區塊類型可以是多個且重複時，<code>區塊大小列表</code>會依序列出每個區塊的大小，其長度與該區塊類型的數量相同。</li></ol> <table><thead><tr><th>說明</th> <th>長度</th> <th>值</th> <th></th></tr></thead> <tbody><tr><td>區塊類型</td> <td>1位元組</td> <td>0x01–0xFF</td> <td><code>uint8</code></td></tr> <tr><td>區塊大小</td> <td>2位元組</td> <td>0x0000–0xFFFF</td> <td><code>uint16</code></td></tr> <tr><td>區塊大小列表</td> <td>動態</td> <td>n/a</td> <td><code>uint16, uint16+</code></td></tr></tbody></table> <p>區塊標頭列表以<em>區塊標頭終止位元組</em> <code>0x00</code> 結束。區塊內容主體緊接在其後面。</p> <h4 id="容器驗證規則"><a href="#容器驗證規則" class="header-anchor">#</a> 容器驗證規則</h4> <ol><li><code>版本號</code> 不能為 <code>0</code>。</li> <li><code>區塊類型</code> 不能為 <code>0</code>。數值 <code>0</code> 是為<em>區塊標頭終止位元組</em>保留的。</li> <li>必須至少有一個區塊（因此至少有一個區塊標頭）。</li> <li>區塊外不能有多餘的位元組。這包括最後一個區塊後多出來的尾端資料。</li></ol> <h3 id="eof-第一版"><a href="#eof-第一版" class="header-anchor">#</a> EOF 第一版</h3> <p>EOF 第一版由數個 EIP 組成，包括本 EIP。由於細節都被詳細定義在各自的 EIP 中，因此本規範中只是簡要討論。要理解 EOF 的完整範圍，請深入檢查對應的 EIP。</p> <h4 id="容器"><a href="#容器" class="header-anchor">#</a> 容器</h4> <p>EOF 第一版容器由 <code>標頭</code> 和 <code>主體</code> 組成。</p> <div class="language-txt extra-class"><pre class="language-txt"><code>容器 := 標頭, 主體
標頭 := 
    魔法標記, 版本號碼, 
    類型區塊標記, 類型區塊大小, 
    程式區塊標記, 程式區塊數量, 程式區塊大小+,
    [容器區塊標記, 容器區塊數量, 容器區塊大小+,]
    資料區塊標記, 資料區塊大小,
    終止符號
主體 := 類型區塊, 程式區塊+, 容器區塊*, 資料區塊
類型區塊 := (輸入, 輸出, 最大堆疊增加)+
</code></pre></div><p><em>注意：<code>,</code> 是連接運算符，<code>+</code> 應解釋為「一個或更多」前一項，<code>*</code> 應解釋為「零個或更多」前一項，<code>[物件]</code> 應解釋為可選物件。</em></p> <h4 id="標頭"><a href="#標頭" class="header-anchor">#</a> 標頭</h4> <table><thead><tr><th>名稱</th> <th>長度</th> <th>值</th> <th>說明</th></tr></thead> <tbody><tr><td>魔法標記</td> <td>2 位元組</td> <td>0xEF00</td> <td></td></tr> <tr><td>版本號</td> <td>1 位元組</td> <td>0x01</td> <td>EOF 版本</td></tr> <tr><td>類型區塊標記</td> <td>1 位元組</td> <td>0x01</td> <td>類型區塊的標記</td></tr> <tr><td>類型區塊大小</td> <td>2 位元組</td> <td>0x0004-0x1000</td> <td>16位無符號(unsigned)大端(big-endian)整數，表示類型區塊內容的長度，每個程式區塊4位元組</td></tr> <tr><td>程式區塊標記</td> <td>1 位元組</td> <td>0x02</td> <td>程式區塊大小區塊的標記</td></tr> <tr><td>程式區塊數量</td> <td>2 位元組</td> <td>0x0001-0x0400</td> <td>16位無符號大端整數，表示程式區塊的數量</td></tr> <tr><td>程式區塊大小</td> <td>2 位元組</td> <td>0x0001-0xFFFF</td> <td>16位無符號大端整數，表示程式區塊內容的長度</td></tr> <tr><td>容器區塊標記</td> <td>1 位元組</td> <td>0x03</td> <td>容器區塊大小區塊的標記</td></tr> <tr><td>容器區塊數量</td> <td>2 位元組</td> <td>0x0001-0x0100</td> <td>16位無符號大端整數，表示容器區塊的數量</td></tr> <tr><td>容器區塊大小</td> <td>4 位元組</td> <td>0x00000001-0xFFFFFFFF</td> <td>32位無符號大端整數，表示容器區塊內容的長度</td></tr> <tr><td>資料區塊標記</td> <td>1 位元組</td> <td>0xFF</td> <td>資料區塊大小區塊的標記</td></tr> <tr><td>資料區塊大小</td> <td>2 位元組</td> <td>0x0000-0xFFFF</td> <td>16位無符號大端整數，表示資料區塊內容的長度 (*)</td></tr> <tr><td>終止符號</td> <td>1 位元組</td> <td>0x00</td> <td>標記標頭的結束</td></tr></tbody></table> <p>(*) 對於尚未部署的容器，這可能大於實際內容長度，我們在部署的章節會特別討論。</p> <h4 id="主體"><a href="#主體" class="header-anchor">#</a> 主體</h4> <table><thead><tr><th>名稱</th> <th>長度</th> <th>值</th> <th>說明</th></tr></thead> <tbody><tr><td>類型區塊</td> <td>可變</td> <td>n/a</td> <td>存儲程式區塊詮釋資料</td></tr> <tr><td>輸入</td> <td>1 位元組</td> <td>0x00-0x7F</td> <td>程式區塊消耗的堆疊元素數量</td></tr> <tr><td>輸出</td> <td>1 位元組</td> <td>0x00-0x7F</td> <td>程式區塊回傳的堆疊元素數量</td></tr> <tr><td>最大堆疊增加</td> <td>2 位元組</td> <td>0x0000-0x03FF</td> <td>程式執行期間堆疊可能增加的最大高度</td></tr> <tr><td>程式區塊</td> <td>可變</td> <td>n/a</td> <td>任意位元碼</td></tr> <tr><td>容器區塊</td> <td>可變</td> <td>n/a</td> <td>任意 EOF 格式的容器</td></tr> <tr><td>資料區塊</td> <td>可變</td> <td>n/a</td> <td>任意位元組序列</td></tr></tbody></table> <p><strong>注意</strong>：<code>輸出</code> 的特殊值 <code>0x80</code> 被指定用於表示不回傳的函數，在單獨的 EIP 中定義。</p> <h4 id="eof-第一版驗證規則"><a href="#eof-第一版驗證規則" class="header-anchor">#</a> EOF 第一版驗證規則</h4> <p>對容器格式有以下有效性約束：</p> <ul><li><code>類型區塊大小</code> 可被 <code>4</code> 整除</li> <li>程式區塊的數量必須等於 <code>類型區塊大小 / 4</code></li> <li>對於尚未部署的容器，資料主體長度可能短於 <code>資料區塊大小</code></li> <li>容器的總大小不得超過 <code>MAX_INITCODE_SIZE</code>（如 <a href="/head-first-eof/eip-3860.html">EIP-3860</a> 中定義）</li></ul> <h3 id="執行語意的更改"><a href="#執行語意的更改" class="header-anchor">#</a> 執行語意的更改</h3> <p>對於 EOF 合約：</p> <ul><li>執行從程式區塊 0 的第一個位元組開始</li> <li><code>CODESIZE</code>、<code>CODECOPY</code>、<code>EXTCODESIZE</code>、<code>EXTCODECOPY</code>、<code>EXTCODEHASH</code>、<code>GAS</code> 在 EOF 合約中被禁止，且將無後續的對應替代指令，驗證階段將被拒絕</li> <li><code>CALL</code>、<code>DELEGATECALL</code>、<code>STATICCALL</code> 在 EOF 合約中也被禁止使用，其相關的替代指令將在單獨的 EIP 中另外定義。</li> <li>從 EOF 合約到非 EOF 合約（傳統合約、EOA、空帳戶）的 <code>DELEGATECALL</code>（或任何 EOF 的替代指令）是不允許的，如被觸發，將以呼叫深度檢查失敗的相同模式觸發錯誤。反之，允許從傳統合約到 EOF 合約的 <code>DELEGATECALL</code>，這樣能使現存的代理合約能夠使用 EOF 升級。</li></ul> <p>對於傳統合約：</p> <ul><li>如果 <code>EXTCODECOPY</code> 的目標帳戶是 EOF 合約，那麼它將複製最多 2 個位元組的 <code>EF00</code>。</li> <li>如果 <code>EXTCODEHASH</code> 的目標帳戶是 EOF 合約，那麼它將回傳 <code>0x9dbf3648db8210552e9c4f75c6a1c3057c0ca432043bd648be15fe7be05646f5</code>（<code>EF00</code> 的雜湊值）。</li> <li>如果 <code>EXTCODESIZE</code> 的目標帳戶是 EOF 合約，那麼它將回傳 2。</li></ul> <p><strong>注意</strong> 與傳統合約一樣，上述 <code>EXTCODECOPY</code>、<code>EXTCODEHASH</code> 和 <code>EXTCODESIZE</code> 的行為不適用於正在部署中的 EOF 合約目標。</p> <h2 id="設計原因"><a href="#設計原因" class="header-anchor">#</a> 設計原因</h2> <ol><li>魔法標記的第一個位元組 <code>0xEF</code> 是特別保留的</li> <li>第二個位元組 <code>0x00</code> 是為了避免與現有的程式衝突</li> <li>版本號從 1 開始，這樣我們可以把舊的程式稱為「版本0」</li> <li>把資料區塊放在最後，因為這是在部署程式時最可能會添加內容的部分，比如有部分的資料需要在初始化階段才能計算出來</li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/hydai/solidity.tw/edit/master/head-first-eof/EIP-3540.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2025/5/21 下午3:09:25</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/head-first-eof/" class="prev router-link-active">
        深入淺出 EOFv1
      </a></span> <span class="next"><a href="/head-first-eof/EIP-3541.html">
        EIP-3541 禁止以 0xEF 開頭的新智慧合約
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.03130786.js" defer></script><script src="/assets/js/2.ce7b5ffa.js" defer></script><script src="/assets/js/1.843ff0e7.js" defer></script><script src="/assets/js/55.21b3d617.js" defer></script>
  </body>
</html>
