<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>EIP-5450: EOF - 堆疊驗證 | 一本關於 Ethereum 與 Solidity 智能合約的書</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="在 2022 年，我們該如何學習智能合約開發">
    
    <link rel="preload" href="/assets/css/0.styles.9f477098.css" as="style"><link rel="preload" href="/assets/js/app.b4a0f8ef.js" as="script"><link rel="preload" href="/assets/js/2.ce7b5ffa.js" as="script"><link rel="preload" href="/assets/js/1.843ff0e7.js" as="script"><link rel="preload" href="/assets/js/66.569b3bd4.js" as="script"><link rel="prefetch" href="/assets/js/10.c12fac62.js"><link rel="prefetch" href="/assets/js/11.c2affc04.js"><link rel="prefetch" href="/assets/js/12.f054eba6.js"><link rel="prefetch" href="/assets/js/13.e4d40fa1.js"><link rel="prefetch" href="/assets/js/14.ed0a28d5.js"><link rel="prefetch" href="/assets/js/15.d25bd3fe.js"><link rel="prefetch" href="/assets/js/16.97c2c4a8.js"><link rel="prefetch" href="/assets/js/17.849d402a.js"><link rel="prefetch" href="/assets/js/18.cdc68d17.js"><link rel="prefetch" href="/assets/js/19.e30826d9.js"><link rel="prefetch" href="/assets/js/20.8effbcd5.js"><link rel="prefetch" href="/assets/js/21.9653cdd5.js"><link rel="prefetch" href="/assets/js/22.cb4ae59c.js"><link rel="prefetch" href="/assets/js/23.b6fc1300.js"><link rel="prefetch" href="/assets/js/24.778ffaf6.js"><link rel="prefetch" href="/assets/js/25.ff81639a.js"><link rel="prefetch" href="/assets/js/26.af99b220.js"><link rel="prefetch" href="/assets/js/27.74198ac3.js"><link rel="prefetch" href="/assets/js/28.a47a9604.js"><link rel="prefetch" href="/assets/js/29.4f16422d.js"><link rel="prefetch" href="/assets/js/3.16c4453f.js"><link rel="prefetch" href="/assets/js/30.f298419f.js"><link rel="prefetch" href="/assets/js/31.1a21d7a4.js"><link rel="prefetch" href="/assets/js/32.14fd2d9a.js"><link rel="prefetch" href="/assets/js/33.416bd998.js"><link rel="prefetch" href="/assets/js/34.82b44d0c.js"><link rel="prefetch" href="/assets/js/35.27e3d54a.js"><link rel="prefetch" href="/assets/js/36.c3b1843c.js"><link rel="prefetch" href="/assets/js/37.d6736751.js"><link rel="prefetch" href="/assets/js/38.ef4141df.js"><link rel="prefetch" href="/assets/js/39.15fc33ad.js"><link rel="prefetch" href="/assets/js/4.7b5274ce.js"><link rel="prefetch" href="/assets/js/40.0c8f408e.js"><link rel="prefetch" href="/assets/js/41.95c43a4c.js"><link rel="prefetch" href="/assets/js/42.37e3dbc1.js"><link rel="prefetch" href="/assets/js/43.726b47f6.js"><link rel="prefetch" href="/assets/js/44.0c623027.js"><link rel="prefetch" href="/assets/js/45.a9d47927.js"><link rel="prefetch" href="/assets/js/46.a01f013b.js"><link rel="prefetch" href="/assets/js/47.f909334f.js"><link rel="prefetch" href="/assets/js/48.f3ce3acc.js"><link rel="prefetch" href="/assets/js/49.bf17f86c.js"><link rel="prefetch" href="/assets/js/5.a90aa973.js"><link rel="prefetch" href="/assets/js/50.76543ed3.js"><link rel="prefetch" href="/assets/js/51.a77781e8.js"><link rel="prefetch" href="/assets/js/52.522cda49.js"><link rel="prefetch" href="/assets/js/53.4e88f52c.js"><link rel="prefetch" href="/assets/js/54.565c39aa.js"><link rel="prefetch" href="/assets/js/55.d04ba7d8.js"><link rel="prefetch" href="/assets/js/56.7ce37e58.js"><link rel="prefetch" href="/assets/js/57.17e6376e.js"><link rel="prefetch" href="/assets/js/58.62087995.js"><link rel="prefetch" href="/assets/js/59.c526d55f.js"><link rel="prefetch" href="/assets/js/6.acf7bb6e.js"><link rel="prefetch" href="/assets/js/60.ab86d4cc.js"><link rel="prefetch" href="/assets/js/61.dc1027c2.js"><link rel="prefetch" href="/assets/js/62.d1faa0e3.js"><link rel="prefetch" href="/assets/js/63.27478a7c.js"><link rel="prefetch" href="/assets/js/64.774fdd9e.js"><link rel="prefetch" href="/assets/js/65.bdeefe51.js"><link rel="prefetch" href="/assets/js/67.faa6f699.js"><link rel="prefetch" href="/assets/js/7.dfcce160.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.d9dffa33.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9f477098.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">一本關於 Ethereum 與 Solidity 智能合約的書</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首頁
</a></div><div class="nav-item"><a href="/ethereum-101/" class="nav-link">
  那些關於 Ethereum 的事
</a></div><div class="nav-item"><a href="https://youtube.com/playlist?list=PLHmOMPRfmOxQYDnXAc1hKY6ra4WDU8ZlM" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在 2022 年，我們該如何寫智能合約
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.youtube.com/playlist?list=PLHmOMPRfmOxTiqyaSu1EXs8ioESZtOSHN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  淺入淺出 EVM Object Format
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hydai/solidity.tw" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首頁
</a></div><div class="nav-item"><a href="/ethereum-101/" class="nav-link">
  那些關於 Ethereum 的事
</a></div><div class="nav-item"><a href="https://youtube.com/playlist?list=PLHmOMPRfmOxQYDnXAc1hKY6ra4WDU8ZlM" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在 2022 年，我們該如何寫智能合約
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.youtube.com/playlist?list=PLHmOMPRfmOxTiqyaSu1EXs8ioESZtOSHN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  淺入淺出 EVM Object Format
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hydai/solidity.tw" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Head First Eof</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/head-first-eof/" aria-current="page" class="sidebar-link">深入淺出 EOFv1</a></li><li><a href="/head-first-eof/10-EIP-3541.html" class="sidebar-link">EIP-3541 禁止以 0xEF 開頭的新智慧合約</a></li><li><a href="/head-first-eof/11-EIP-3540.html" class="sidebar-link">EIP-3540 電腦程式的新衣服 - EVM 物件格式 (EOF)</a></li><li><a href="/head-first-eof/12-EIP-3670.html" class="sidebar-link">EIP-3670: 智慧合約的程式碼檢查</a></li><li><a href="/head-first-eof/13-EIP-4200.html" class="sidebar-link">EIP-4200：EOF - 靜態相對跳躍</a></li><li><a href="/head-first-eof/14-EIP-7480.html" class="sidebar-link">EIP-7480: EOF - 資料區段存取指令</a></li><li><a href="/head-first-eof/15-EIP-663.html" class="sidebar-link">EIP-663：SWAPN、DUPN 和 EXCHANGE 指令</a></li><li><a href="/head-first-eof/16-EIP-7069.html" class="sidebar-link">EIP-7069 改良版呼叫指令</a></li><li><a href="/head-first-eof/17-EIP-4750.html" class="sidebar-link">EIP-4750 EOF 函式功能</a></li><li><a href="/head-first-eof/18-EIP-6206.html" class="sidebar-link">EIP-6206 - JUMPF 與非回傳函式</a></li><li><a href="/head-first-eof/19-EIP-7620.html" class="sidebar-link">EIP-7620：EOF 合約部署新方式</a></li><li><a href="/head-first-eof/20-EIP-7698.html" class="sidebar-link">EIP-7698: EOF - 部署交易</a></li><li><a href="/head-first-eof/21-EIP-5450.html" aria-current="page" class="active sidebar-link">EIP-5450: EOF - 堆疊驗證</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/head-first-eof/21-EIP-5450.html#注意事項" class="sidebar-link">注意事項</a></li><li class="sidebar-sub-header"><a href="/head-first-eof/21-EIP-5450.html#簡介" class="sidebar-link">簡介</a></li><li class="sidebar-sub-header"><a href="/head-first-eof/21-EIP-5450.html#什麼是堆疊-stack" class="sidebar-link">什麼是堆疊(Stack)？</a></li><li class="sidebar-sub-header"><a href="/head-first-eof/21-EIP-5450.html#這個新功能能怎麼幫助我們" class="sidebar-link">這個新功能能怎麼幫助我們</a></li><li class="sidebar-sub-header"><a href="/head-first-eof/21-EIP-5450.html#怎麼運作的" class="sidebar-link">怎麼運作的？</a></li><li class="sidebar-sub-header"><a href="/head-first-eof/21-EIP-5450.html#為什麼要這樣做" class="sidebar-link">為什麼要這樣做？</a></li><li class="sidebar-sub-header"><a href="/head-first-eof/21-EIP-5450.html#這對現存的-evm-會有影響嗎" class="sidebar-link">這對現存的 EVM 會有影響嗎？</a></li><li class="sidebar-sub-header"><a href="/head-first-eof/21-EIP-5450.html#一個簡單的例子" class="sidebar-link">一個簡單的例子</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="eip-5450-eof-堆疊驗證"><a href="#eip-5450-eof-堆疊驗證" class="header-anchor">#</a> EIP-5450: EOF - 堆疊驗證</h1> <h2 id="注意事項"><a href="#注意事項" class="header-anchor">#</a> 注意事項</h2> <p>本文並沒有經過作者外的其他審查者審核，因此若內容有誤，請到 issue 區提出問題，我會儘速修改，謝謝。</p> <h2 id="簡介"><a href="#簡介" class="header-anchor">#</a> 簡介</h2> <p>本文以 EIP-5450 EOF: Stack Validation 作為說明。</p> <p>各位寫過 Solidity 嗎？或者執行過 EVM 程式碼嗎？還記得那個萬惡的「堆疊溢位」嗎？
今天我們將透過這個新的 EIP-5450 盡可能地消除這些問題，讓我們的程式碼更安全、更簡單！考試都考一百分呢(=ﾟωﾟ)ﾉ</p> <h2 id="什麼是堆疊-stack"><a href="#什麼是堆疊-stack" class="header-anchor">#</a> 什麼是堆疊(Stack)？</h2> <p>想像一下，你的手邊有一堆積木要堆起來。如果堆得不穩，積木可能會倒塌，對吧？
在電腦世界裡，也有一種類似的結構，就叫做「堆疊」，就像是積木堆一樣，放置的時候要從底層往上方層層疊上；而當要取出積木時，則是從最上面開始向下一一拿取，這樣才能確保不會把底下的積木弄倒。
而在 EVM 裡，這些積木就是我們的程式碼執行途中放置的數值，可能是某個函式的參數，又或是某個指令計算出來的結果等。
然而，如果我們不小心把積木堆得太高，超過上限導致整個堆疊倒塌，就會發生「堆疊溢位」的問題。而在 EVM 的設計中，就要求堆疊的深度不能超過 1024 層。</p> <h2 id="這個新功能能怎麼幫助我們"><a href="#這個新功能能怎麼幫助我們" class="header-anchor">#</a> 這個新功能能怎麼幫助我們</h2> <p>這就像是在指考或者學測時，寫完試卷後，我們會多檢查一次，希望透過這次自我檢查，來避免不小心犯下的錯誤，就不會在最後的成績被扣分一樣。
同樣的模式，便是在我們將合約部署到鏈上之前，透過堆疊驗證來提前檢查與堆疊相關的問題，這樣就能避免在合約執行時發生錯誤，讓我們的程式碼更安全、更不容易到執行期間才慘遭毀滅性的打擊。</p> <p>師爺，你給解釋解釋，好處有哪些？</p> <ul><li>EVM 不需要每次都檢查堆疊是不是不夠被拿取（叫做「堆疊下溢」）。</li> <li>EVM 也不需要一直擔心堆疊會堆太高（叫做「堆疊上溢」），除了以下兩個例外 <code>CALLF</code> 與 <code>JUMPF</code> 外。</li> <li>確保每個 EVM 能正確結束，也就是執行的結尾需要是中止指令(terminating instructions)。</li> <li>不讓人亂放資料在不應該放的地方，因此不鼓勵在程式碼中放置無法被執行的指令作為附加資料。</li></ul> <p>當然，不能只說好話，帶來好處的同時，也伴隨著一些缺點：</p> <ul><li>程式碼存在必要的規範，與過去 EVM 的程式碼是隨便開發者自由隨喜，現在需要像樂高積木一樣要按照零件的基礎規則來組成，如同其他常見的語言：JVM Bytecode、WebAssembly 等。</li> <li>檢查的方式可能看起來有點複雜，但在這個 EIP 中規範的檢查方式其實很簡單！且只為線性掃描，不會帶來過多的負擔。</li></ul> <h2 id="怎麼運作的"><a href="#怎麼運作的" class="header-anchor">#</a> 怎麼運作的？</h2> <p>每一段程式碼都會被單獨檢查。</p> <h3 id="第一次檢查"><a href="#第一次檢查" class="header-anchor">#</a> 第一次檢查</h3> <p>首先，檢查每一個指令是不是合法有效的指令(以 EOFv1 所定義的有效為主，請注意，你可能需要查詢其他 EOFv1 的 EIPs 來看哪些指令已經被棄用了)。</p> <h3 id="第二次檢查"><a href="#第二次檢查" class="header-anchor">#</a> 第二次檢查</h3> <p>然後，從頭到尾掃描所有指令，確保指令能正確地堆在一起。</p> <p>想像一下，電腦會記錄每一步可能的積木高度。如果任何時候積木會倒塌或堆太高，電腦就會說「不行！這樣不安全！」</p> <h2 id="為什麼要這樣做"><a href="#為什麼要這樣做" class="header-anchor">#</a> 為什麼要這樣做？</h2> <h3 id="經過檢查的程式碼有這些特點"><a href="#經過檢查的程式碼有這些特點" class="header-anchor">#</a> 經過檢查的程式碼有這些特點</h3> <ol><li>沒有永遠用不到的指令（就像沒有永遠不會用到的積木）</li> <li>沒有只能從後面跳過去的指令</li> <li>積木永遠不會不夠用</li> <li>積木只有在特定情況下才可能堆太高</li> <li>可以從不同的積木高度跳到同一個地方</li> <li>往回跳的時候，積木高度必須一樣（這樣就不會無限堆高了）</li> <li>最後一個指令一定是結束指令或跳躍指令</li></ol> <h3 id="積木堆太高的檢查"><a href="#積木堆太高的檢查" class="header-anchor">#</a> 積木堆太高的檢查</h3> <p>這個新功能讓電腦只需要在特定指令時檢查積木會不會堆太高，這樣可以讓程式跑得更快！</p> <h3 id="用不到的程式碼"><a href="#用不到的程式碼" class="header-anchor">#</a> 用不到的程式碼</h3> <p>這個檢查不允許有永遠用不到的指令，就像你不會買一組樂高但永遠不用其中某些積木一樣。這讓檢查變得更快，也避免了怪怪的程式碼。</p> <h3 id="結束時的乾淨堆疊"><a href="#結束時的乾淨堆疊" class="header-anchor">#</a> 結束時的乾淨堆疊</h3> <p>當函數結束時，堆疊必須乾乾淨淨的，就像你玩完玩具要收好一樣。這樣可以讓程式更簡單，也更容易理解。</p> <h3 id="積木順序"><a href="#積木順序" class="header-anchor">#</a> 積木順序</h3> <p>指令的順序很重要！就像樂高說明書一樣，你不能跳著步驟做，否則可能會搭錯。</p> <h2 id="這對現存的-evm-會有影響嗎"><a href="#這對現存的-evm-會有影響嗎" class="header-anchor">#</a> 這對現存的 EVM 會有影響嗎？</h2> <p>不用擔心！這個改變只會影響對啟用了 EOFv1 格式的新合約生效，現存與使用傳統的 EVM 格式不會受到任何影響。</p> <h2 id="一個簡單的例子"><a href="#一個簡單的例子" class="header-anchor">#</a> 一個簡單的例子</h2> <p>讓我們用一個遊戲模型來了解這是怎麼運作的：</p> <h3 id="積木遊戲範例"><a href="#積木遊戲範例" class="header-anchor">#</a> 積木遊戲範例</h3> <p>想像你有一個特殊的積木遊戲，有這些指令：</p> <ul><li><code>放上</code> - 放一塊積木到堆疊上</li> <li><code>拿走</code> - 從堆疊上拿走一塊積木</li> <li><code>跳到</code> - 跳到遊戲的另一個步驟</li> <li><code>如果高就跳</code> - 如果堆疊夠高，就跳到另一個步驟</li> <li><code>結束</code> - 遊戲結束</li></ul> <p>現在，我們來看看這個積木遊戲的指令：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>步驟1: 放上 (堆疊高度變成1)
步驟2: 放上 (堆疊高度變成2)
步驟3: 如果高就跳到步驟6 (因為有2塊積木，所以會跳)
步驟4: 放上 (這步不會執行)
步驟5: 拿走 (這步不會執行)
步驟6: 拿走 (堆疊高度變成1)
步驟7: 跳到步驟9 (直接跳到步驟9)
步驟8: 拿走 (這步不會執行)
步驟9: 拿走 (堆疊高度變成0)
步驟10: 結束
</code></pre></div><h3 id="電腦如何檢查這個遊戲"><a href="#電腦如何檢查這個遊戲" class="header-anchor">#</a> 電腦如何檢查這個遊戲</h3> <p>現在，想像電腦在你玩之前先檢查這個遊戲：</p> <ol><li><p><strong>第一次檢查</strong>：確認所有指令都是有效的（放上、拿走、跳到、如果高就跳、結束）✓ 沒問題！</p></li> <li><p><strong>第二次檢查（堆疊驗證）</strong>：</p> <ul><li>TODO: 使用表格的方式來說明驗證機制</li></ul></li></ol> <p>這個遊戲通過了檢查！因為：</p> <ul><li>沒有任何時候會拿走不存在的積木（堆疊下溢）</li> <li>堆疊高度不會超過限制（堆疊上溢）</li> <li>所有的指令都能被執行到（沒有無用的指令）</li> <li>遊戲能夠正確結束</li></ul> <h3 id="問題遊戲範例"><a href="#問題遊戲範例" class="header-anchor">#</a> 問題遊戲範例</h3> <p>再看一個有問題的遊戲：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>步驟1: 放上 (堆疊高度變成1)
步驟2: 跳到步驟4 (直接跳到步驟4)
步驟3: 放上 (這步不會執行)
步驟4: 拿走 (堆疊高度變成0)
步驟5: 拿走 (糟糕！沒有積木可以拿了！)
步驟6: 結束
</code></pre></div><p>電腦檢查時會發現：</p> <ul><li>到了步驟5，堆疊已經是0了，再拿走就會變成-1，這是不可能的！</li> <li>電腦會說：「這個遊戲有問題，不能玩！」</li></ul> <p>這就是堆疊驗證的作用！它可以在你開始玩之前，就找出遊戲中可能出現的問題，讓你玩得更安全、更順暢。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/hydai/solidity.tw/edit/master/head-first-eof/21-EIP-5450.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2025/5/21 下午3:18:25</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/head-first-eof/20-EIP-7698.html" class="prev">
        EIP-7698: EOF - 部署交易
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b4a0f8ef.js" defer></script><script src="/assets/js/2.ce7b5ffa.js" defer></script><script src="/assets/js/1.843ff0e7.js" defer></script><script src="/assets/js/66.569b3bd4.js" defer></script>
  </body>
</html>
